<?xml version="1.0" encoding="utf-8"?>
<Stateflow>
  <machine id="20">
    <P Name="created">26-Aug-2015 16:04:47</P>
    <P Name="isLibrary">0</P>
    <P Name="sfVersion">80000006</P>
    <Children>
      <target id="39" name="sfun">
        <P Name="description">Default Simulink S-Function Target.</P>
      </target>
      <chart id="21">
        <P Name="name">MPC/MPC</P>
        <P Name="windowPosition">[422 539.941 189 413]</P>
        <P Name="viewLimits">[0 156.75 0 153.75]</P>
        <P Name="screen">[1 1 3600 1200 1.180555555555556]</P>
        <P Name="viewObj">21</P>
        <P Name="visible">1</P>
        <subviewS>
        </subviewS>
        <P Name="ssIdHighWaterMark">19</P>
        <P Name="decomposition">CLUSTER_CHART</P>
        <P Name="type">EML_CHART</P>
        <P Name="chartFileNumber">1</P>
        <P Name="disableImplicitCasting">1</P>
        <eml>
          <P Name="name">myMPController</P>
        </eml>
        <Children>
          <state SSID="1">
            <P Name="labelString">eML_blk_kernel()</P>
            <P Name="position">[18 64.5 118 66]</P>
            <P Name="fontSize">12</P>
            <P Name="superState">SUBCHART</P>
            <P Name="subviewer">21</P>
            <P Name="type">FUNC_STATE</P>
            <P Name="decomposition">CLUSTER_STATE</P>
            <eml>
              <P Name="isEML">1</P>
              <P Name="script">function [u,status,iA1] = myMPController(H,G,gs,F,bb,J,L,x,xTarget,iA)
% H       - quadratic term in the cost function (Linv if using mpcqpsolver).
% G       - matrix in the linear term of the cost function.
% gs      - vector in the linear term of the cost function.
% F       - LHS of the inequalities term.
% bb      - RHS of the inequalities term.
% J       - RHS of inequalities term.
% L       - RHS of inequalities term. Use this to shift constraints around target point
% x       - current state
% xTarget - target equilibrium point.
% nu      - Number of inputs.
% iA      - active inequalities, see doc mpcqpsolver
%
% u is the first input vector u_0 in the sequence [u_0; u_1; ...; u_{N-1}]; 
% In other words, u is the value of the receding horizon control law
% evaluated with the current state x and target xTarget

% Please read the documentation on mpcqpsolver to understand how it is
% suppose to be used. Use iA and iA1 to pass the active inequality vector 

opt = mpcqpsolverOptions;
opt.IntegrityChecks = false; % for code generation
opt.FeasibilityTol = 1e-3;
opt.DataType = &apos;double&apos;;
% your code starts here
Gnew=[G*(x-xTarget);gs];
b=bb+J*x+L*xTarget;
[U,status,iA1]=mpcqpsolver(H,Gnew,-F,-b,[],zeros(0,1),iA,opt);
% your code ends here
% Copy and paste the indicated parts of your code above to the Simulink model
u=U(1:2);
end</P>
              <P Name="editorLayout" Class="double">Matrix(4,1)
[[10.0]; [5.0]; [700.0]; [500.0]]</P>
            </eml>
          </state>
          <data SSID="7" name="H">
            <P Name="scope">INPUT_DATA</P>
            <props>
              <array>
                <P Name="size">-1</P>
              </array>
              <type>
                <P Name="method">SF_INHERITED_TYPE</P>
                <P Name="primitive">SF_DOUBLE_TYPE</P>
                <P Name="isSigned">1</P>
                <P Name="wordLength">16</P>
              </type>
              <P Name="complexity">SF_COMPLEX_INHERITED</P>
              <P Name="frame">SF_FRAME_INHERITED</P>
            </props>
            <P Name="dataType">Inherit: Same as Simulink</P>
          </data>
          <data SSID="4" name="G">
            <P Name="scope">INPUT_DATA</P>
            <props>
              <array>
                <P Name="size">-1</P>
              </array>
              <type>
                <P Name="method">SF_INHERITED_TYPE</P>
                <P Name="primitive">SF_DOUBLE_TYPE</P>
              </type>
              <P Name="complexity">SF_COMPLEX_INHERITED</P>
            </props>
            <P Name="dataType">Inherit: Same as Simulink</P>
          </data>
          <data SSID="19" name="gs">
            <P Name="scope">INPUT_DATA</P>
            <props>
              <array>
                <P Name="size">-1</P>
              </array>
              <type>
                <P Name="method">SF_INHERITED_TYPE</P>
                <P Name="primitive">SF_DOUBLE_TYPE</P>
                <P Name="isSigned">1</P>
                <P Name="wordLength">16</P>
              </type>
              <P Name="complexity">SF_COMPLEX_INHERITED</P>
              <P Name="frame">SF_FRAME_INHERITED</P>
            </props>
            <P Name="dataType">Inherit: Same as Simulink</P>
          </data>
          <data SSID="5" name="u">
            <P Name="scope">OUTPUT_DATA</P>
            <props>
              <array>
                <P Name="size">-1</P>
              </array>
              <type>
                <P Name="method">SF_INHERITED_TYPE</P>
                <P Name="primitive">SF_DOUBLE_TYPE</P>
              </type>
              <P Name="complexity">SF_COMPLEX_INHERITED</P>
              <P Name="frame">SF_FRAME_NO</P>
            </props>
            <P Name="dataType">Inherit: Same as Simulink</P>
          </data>
          <data SSID="6" name="F">
            <P Name="scope">INPUT_DATA</P>
            <props>
              <array>
                <P Name="size">-1</P>
              </array>
              <type>
                <P Name="method">SF_INHERITED_TYPE</P>
                <P Name="primitive">SF_DOUBLE_TYPE</P>
                <P Name="isSigned">1</P>
                <P Name="wordLength">16</P>
              </type>
              <P Name="complexity">SF_COMPLEX_INHERITED</P>
              <P Name="frame">SF_FRAME_INHERITED</P>
            </props>
            <P Name="dataType">Inherit: Same as Simulink</P>
          </data>
          <data SSID="17" name="bb">
            <P Name="scope">INPUT_DATA</P>
            <props>
              <array>
                <P Name="size">-1</P>
              </array>
              <type>
                <P Name="method">SF_INHERITED_TYPE</P>
                <P Name="primitive">SF_DOUBLE_TYPE</P>
                <P Name="isSigned">1</P>
                <P Name="wordLength">16</P>
              </type>
              <P Name="complexity">SF_COMPLEX_INHERITED</P>
              <P Name="frame">SF_FRAME_INHERITED</P>
            </props>
            <P Name="dataType">Inherit: Same as Simulink</P>
          </data>
          <data SSID="8" name="J">
            <P Name="scope">INPUT_DATA</P>
            <props>
              <array>
                <P Name="size">-1</P>
              </array>
              <type>
                <P Name="method">SF_INHERITED_TYPE</P>
                <P Name="primitive">SF_DOUBLE_TYPE</P>
                <P Name="isSigned">1</P>
                <P Name="wordLength">16</P>
              </type>
              <P Name="complexity">SF_COMPLEX_INHERITED</P>
              <P Name="frame">SF_FRAME_INHERITED</P>
            </props>
            <P Name="dataType">Inherit: Same as Simulink</P>
          </data>
          <data SSID="9" name="L">
            <P Name="scope">INPUT_DATA</P>
            <props>
              <array>
                <P Name="size">-1</P>
              </array>
              <type>
                <P Name="method">SF_INHERITED_TYPE</P>
                <P Name="primitive">SF_DOUBLE_TYPE</P>
                <P Name="isSigned">1</P>
                <P Name="wordLength">16</P>
              </type>
              <P Name="complexity">SF_COMPLEX_INHERITED</P>
              <P Name="frame">SF_FRAME_INHERITED</P>
            </props>
            <P Name="dataType">Inherit: Same as Simulink</P>
          </data>
          <data SSID="10" name="x">
            <P Name="scope">INPUT_DATA</P>
            <props>
              <array>
                <P Name="size">-1</P>
              </array>
              <type>
                <P Name="method">SF_INHERITED_TYPE</P>
                <P Name="primitive">SF_DOUBLE_TYPE</P>
                <P Name="isSigned">1</P>
                <P Name="wordLength">16</P>
              </type>
              <P Name="complexity">SF_COMPLEX_INHERITED</P>
              <P Name="frame">SF_FRAME_INHERITED</P>
            </props>
            <P Name="dataType">Inherit: Same as Simulink</P>
          </data>
          <data SSID="11" name="xTarget">
            <P Name="scope">INPUT_DATA</P>
            <props>
              <array>
                <P Name="size">-1</P>
              </array>
              <type>
                <P Name="method">SF_INHERITED_TYPE</P>
                <P Name="primitive">SF_DOUBLE_TYPE</P>
                <P Name="isSigned">1</P>
                <P Name="wordLength">16</P>
              </type>
              <P Name="complexity">SF_COMPLEX_INHERITED</P>
              <P Name="frame">SF_FRAME_INHERITED</P>
            </props>
            <P Name="dataType">Inherit: Same as Simulink</P>
          </data>
          <data SSID="13" name="status">
            <P Name="scope">OUTPUT_DATA</P>
            <props>
              <array>
                <P Name="size">-1</P>
              </array>
              <type>
                <P Name="method">SF_INHERITED_TYPE</P>
                <P Name="primitive">SF_DOUBLE_TYPE</P>
                <P Name="isSigned">1</P>
                <P Name="wordLength">16</P>
              </type>
              <P Name="complexity">SF_COMPLEX_INHERITED</P>
              <P Name="frame">SF_FRAME_NO</P>
            </props>
            <P Name="dataType">Inherit: Same as Simulink</P>
          </data>
          <data SSID="14" name="iA">
            <P Name="scope">INPUT_DATA</P>
            <props>
              <array>
                <P Name="size">-1</P>
              </array>
              <type>
                <P Name="primitive">SF_BOOLEAN_TYPE</P>
                <P Name="isSigned">1</P>
                <P Name="wordLength">16</P>
              </type>
              <P Name="complexity">SF_COMPLEX_INHERITED</P>
              <P Name="frame">SF_FRAME_NO</P>
            </props>
            <P Name="dataType">boolean</P>
          </data>
          <data SSID="15" name="iA1">
            <P Name="scope">OUTPUT_DATA</P>
            <props>
              <array>
                <P Name="size">-1</P>
              </array>
              <type>
                <P Name="primitive">SF_BOOLEAN_TYPE</P>
                <P Name="isSigned">1</P>
                <P Name="wordLength">16</P>
              </type>
              <P Name="complexity">SF_COMPLEX_INHERITED</P>
              <P Name="frame">SF_FRAME_NO</P>
            </props>
            <P Name="dataType">boolean</P>
          </data>
          <transition SSID="2">
            <P Name="labelString">{eML_blk_kernel();}</P>
            <P Name="labelPosition">[28.125 13.875 102.544 14.964]</P>
            <P Name="fontSize">12</P>
            <src>
              <P Name="intersection">[0 0 1 0 23.5747 14.625 0 0]</P>
            </src>
            <dst>
              <P Name="SSID">3</P>
              <P Name="intersection">[1 0 -1 0 23.5747 42.5747 0 0]</P>
            </dst>
            <P Name="midPoint">[23.5747 24.9468]</P>
            <P Name="dataLimits">[21.175 25.975 14.625 42.575]</P>
            <P Name="subviewer">21</P>
            <P Name="drawStyle">SMART</P>
            <slide>
              <P Name="sticky">BOTH_STICK</P>
            </slide>
            <P Name="executionOrder">1</P>
          </transition>
          <junction SSID="3">
            <P Name="position">[23.5747 49.5747 7]</P>
            <P Name="subviewer">21</P>
            <P Name="type">CONNECTIVE_JUNCTION</P>
          </junction>
        </Children>
      </chart>
    </Children>
  </machine>
  <instance id="38">
    <P Name="name">MPC/MPC</P>
    <P Name="machine">20</P>
    <P Name="chart">21</P>
  </instance>
</Stateflow>
